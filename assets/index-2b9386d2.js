var _e=Object.defineProperty;var be=(s,e,n)=>e in s?_e(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var Q=(s,e,n)=>(be(s,typeof e!="symbol"?e+"":e,n),n);import{d as Z,r as E,c as M,a as z,o as W,b as me,e as x,f as t,g as ye,t as r,F as j,h as G,u as c,i as w,n as N,w as F,v as J,j as we,k as B,l as ne,m as ke,p as se,q as xe,K as Se,s as pe,x as le,y as ve,z as Ee,A as H,B as $e,C as Ce}from"./vendor-3309a345.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const u of d.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function n(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(a){if(a.ep)return;a.ep=!0;const d=n(a);fetch(a.href,d)}})();const Y="pistaink_app_data",K="pistaink_settings";class De{async getData(){try{const e=localStorage.getItem(Y);return e?JSON.parse(e):null}catch(e){return console.error("Error loading app data:",e),null}}async loadDefaultData(){var a,d;const e=["/static/default.json","./static/default.json","static/default.json","../static/default.json",window.location.origin+"/static/default.json"],n=new Date().getTime();for(const u of e){const m=`${u}?_=${n}`;console.log(`尝试从路径加载默认数据: ${m}`);try{const v=await fetch(m);if(!v.ok){console.warn(`路径 ${m} 加载失败: HTTP错误 ${v.status}`);continue}console.log(`成功从 ${m} 获取响应`);const p=await v.text();if(!p||p.trim()===""){console.warn(`路径 ${m} 返回的数据为空`);continue}try{const l=JSON.parse(p);return console.log("成功解析default.json数据:",{engines:((a=l.engines)==null?void 0:a.length)||0,shortcuts:((d=l.shortcuts)==null?void 0:d.length)||0,defaultEngine:l.defaultEngine}),this.saveData(l),console.log("默认数据已保存到本地存储"),l}catch(l){console.error(`解析JSON失败 (${m}):`,l);continue}}catch(v){console.warn(`尝试路径 ${m} 时出错:`,v)}}console.error("所有路径都无法加载默认数据，创建基本的默认数据");const o={engines:[{id:"google",name:{zh:"谷歌",en:"Google"},url:"https://www.google.com/search?q=",iconUrl:"https://www.google.com/favicon.ico"},{id:"bing",name:{zh:"必应",en:"Microsoft Bing"},url:"https://www.bing.com/search?q=",iconUrl:"https://www.bing.com/favicon.ico"},{id:"baidu",name:{zh:"百度",en:"Baidu"},url:"https://www.baidu.com/s?wd=",iconUrl:"https://www.baidu.com/favicon.ico"}],shortcuts:[{id:"github",name:{zh:"GitHub",en:"GitHub"},url:"https://github.com",iconUrl:"https://github.com/favicon.ico"},{id:"youtube",name:{zh:"YouTube",en:"YouTube"},url:"https://youtube.com",iconUrl:"https://www.youtube.com/favicon.ico"}],defaultEngine:"bing",defaultLanguage:"zh",languages:{}};return this.saveData(o),o}async saveData(e){try{localStorage.setItem(Y,JSON.stringify(e))}catch(n){throw console.error("Error saving app data:",n),n}}getSettings(){try{const e=localStorage.getItem(K);return e?JSON.parse(e):null}catch(e){return console.error("Error loading settings:",e),null}}saveSettings(e){try{localStorage.setItem(K,JSON.stringify(e))}catch(n){throw console.error("Error saving settings:",n),n}}getIconCache(){try{const e=localStorage.getItem("pistaink_icons");return e?JSON.parse(e):{}}catch(e){return console.error("Error loading icon cache:",e),{}}}saveIconCache(e){try{localStorage.setItem("pistaink_icons",JSON.stringify(e))}catch(n){throw console.error("Error saving icon cache:",n),n}}exportData(){try{const e=localStorage.getItem(Y)||"{}",n=localStorage.getItem(K)||"{}",o={appData:JSON.parse(e),settings:JSON.parse(n)};return JSON.stringify(o,null,2)}catch(e){throw console.error("Error exporting data:",e),e}}importData(e){try{const n=JSON.parse(e);return n.appData&&localStorage.setItem(Y,JSON.stringify(n.appData)),n.settings&&localStorage.setItem(K,JSON.stringify(n.settings)),!0}catch(n){return console.error("Error importing data:",n),!1}}clearAllData(){localStorage.removeItem(Y),localStorage.removeItem(K),localStorage.removeItem("pistaink_icons")}}const A=new De;function ie(s=8){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";const o=e.length;for(let a=0;a<s;a++)n+=e.charAt(Math.floor(Math.random()*o));return n}function fe(s){return s?s.startsWith("http://")||s.startsWith("https://")?s:`https://${s}`:""}const ee=Z("data",()=>{const s=E([]),e=E([]),n=E(""),o=E(!1),a=E(null),d=M(()=>_=>s.value.find(i=>i.id===_)),u=M(()=>_=>e.value.find(i=>i.id===_));async function m(){o.value=!0,a.value=null;try{console.log("开始加载数据...");let _=await A.getData();if(console.log("本地存储数据检查结果:",_?"找到数据":"未找到数据"),_||(console.log("本地未找到数据，尝试加载默认数据..."),_=await A.loadDefaultData(),console.log("默认数据加载结果:",_?"加载成功":"加载失败")),_)console.log("成功获取数据，更新状态..."),s.value=_.engines||[],e.value=_.shortcuts||[],n.value=_.defaultEngine||"",console.log(`加载了 ${s.value.length} 个搜索引擎`),console.log(`加载了 ${e.value.length} 个快捷方式`),console.log(`默认引擎ID: ${n.value}`),await v();else{console.error("无法加载数据，使用空数据"),s.value=[],e.value=[],n.value="",a.value="无法加载数据",console.log("尝试最后的备用方案，直接解析 default.json...");try{const i={engines:[{id:"google",name:{zh:"谷歌",en:"Google"},url:"https://www.google.com/search?q="},{id:"bing",name:{zh:"必应",en:"Microsoft Bing"},url:"https://www.bing.com/search?q="}],defaultEngine:"bing",shortcuts:[]};console.log("使用内置默认数据..."),s.value=i.engines,n.value=i.defaultEngine,await v()}catch(i){console.error("备用方案也失败:",i)}}}catch(_){const i=_;console.error("加载数据失败:",i),a.value=i.message}finally{o.value=!1}}async function v(){try{const _={engines:s.value,shortcuts:e.value,defaultEngine:n.value,defaultLanguage:"zh",languages:{}};await A.saveData(_)}catch(_){const i=_;throw console.error("保存数据失败:",i),i}}async function p(_){try{const i={id:ie(),..._};return s.value.push(i),s.value.length===1&&(n.value=i.id),await v(),i}catch(i){const k=i;throw console.error("添加搜索引擎失败:",k),k}}async function l(_,i){try{const k=s.value.findIndex(h=>h.id===_);if(k===-1)throw new Error("未找到搜索引擎");s.value[k]={...s.value[k],...i},await v()}catch(k){const h=k;throw console.error("更新搜索引擎失败:",h),h}}async function S(_){try{s.value=s.value.filter(i=>i.id!==_),n.value===_&&s.value.length>0&&(n.value=s.value[0].id),await v()}catch(i){const k=i;throw console.error("删除搜索引擎失败:",k),k}}async function y(_){try{if(!s.value.some(i=>i.id===_))throw new Error("无效的搜索引擎ID");n.value=_,await v()}catch(i){const k=i;throw console.error("设置默认搜索引擎失败:",k),k}}async function g(_){try{const i={id:ie(),..._};return e.value.push(i),await v(),i}catch(i){const k=i;throw console.error("添加快捷方式失败:",k),k}}async function f(_,i){try{const k=e.value.findIndex(h=>h.id===_);if(k===-1)throw new Error("未找到快捷方式");e.value[k]={...e.value[k],...i},await v()}catch(k){const h=k;throw console.error("更新快捷方式失败:",h),h}}async function $(_){try{e.value=e.value.filter(i=>i.id!==_),await v()}catch(i){const k=i;throw console.error("删除快捷方式失败:",k),k}}return{engines:s,shortcuts:e,defaultEngine:n,isLoading:o,error:a,getEngineById:d,getShortcutById:u,loadData:m,saveData:v,addEngine:p,updateEngine:l,deleteEngine:S,setDefaultEngine:y,addShortcut:g,updateShortcut:f,deleteShortcut:$}}),q={themeMode:"auto",backgroundSettings:{type:"bing",opacity:.3},language:"zh"},X=Z("settings",()=>{const s=E(q.themeMode),e=E(q.backgroundSettings),n=E(q.language);async function o(){try{const l=A.getSettings();l&&(s.value=l.themeMode||q.themeMode,e.value=l.backgroundSettings||q.backgroundSettings,n.value=l.language||q.language),u()}catch(l){console.error("Failed to load settings:",l)}}async function a(){try{const l={themeMode:s.value,backgroundSettings:e.value,language:n.value};A.saveSettings(l)}catch(l){console.error("Failed to save settings:",l)}}function d(l){s.value=l,u(),a()}function u(){const l=document.documentElement;if(s.value==="auto"){const S=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;l.setAttribute("data-theme",S?"dark":"light")}else l.setAttribute("data-theme",s.value)}function m(l){e.value=l,a()}function v(l){n.value=l,a()}function p(){s.value=q.themeMode,e.value=q.backgroundSettings,n.value=q.language,u(),a()}return{themeMode:s,backgroundSettings:e,language:n,loadSettings:o,saveSettings:a,setThemeMode:d,setBackgroundSettings:m,setLanguage:v,resetSettings:p}}),R=Z("i18n",()=>{const s=E("zh"),e=E({}),n=E(!1),o=E(null),a=M(()=>g=>e.value[s.value]&&e.value[s.value][g]||g),d=M(()=>Object.keys(e.value));async function u(){n.value=!0,o.value=null;try{let g=await A.getData();g||(g=await A.loadDefaultData()),g?(e.value=g.languages||{},g.defaultLanguage&&(s.value=g.defaultLanguage)):o.value="无法加载语言数据"}catch(g){const f=g;console.error("初始化国际化失败:",f),o.value=f.message}finally{n.value=!1}}function m(g){if(!e.value[g]){console.warn(`语言 ${g} 不存在`);return}s.value=g,v(g)}async function v(g){try{const f=await A.getData();f&&(f.defaultLanguage=g,await A.saveData(f))}catch(f){const $=f;throw console.error("更新默认语言失败:",$),$}}async function p(g,f){try{e.value[g]?e.value[g]={...e.value[g],...f}:e.value[g]=f,await y()}catch($){const _=$;throw console.error("添加语言失败:",_),_}}async function l(g){try{if(Object.keys(e.value).length<=1)throw new Error("不能删除唯一的语言");if(s.value===g)throw new Error("不能删除当前使用的语言");const f={...e.value};delete f[g],e.value=f,await y()}catch(f){const $=f;throw console.error("删除语言失败:",$),$}}async function S(g,f,$){try{if(!e.value[g])throw new Error(`语言 ${g} 不存在`);e.value[g][f]=$,await y()}catch(_){const i=_;throw console.error("更新翻译失败:",i),i}}async function y(){try{const g=await A.getData();g&&(g.languages=e.value,await A.saveData(g))}catch(g){const f=g;throw console.error("保存语言包失败:",f),f}}return{currentLanguage:s,languages:e,isLoading:n,error:o,t:a,availableLanguages:d,initI18n:u,setLanguage:m,addLanguage:p,removeLanguage:l,updateTranslation:S,saveLanguages:y}}),ce="pistaink_bing_image",re="pistaink_bing_image_date";function Ie(){const s=X(),e=E(!1),n=E(null);async function o(){e.value=!0,n.value=null;try{const d=localStorage.getItem(ce),u=localStorage.getItem(re),m=new Date().toDateString();if(d&&u===m)return d;const v="https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1",p="https://picsum.photos/1920/1080";return localStorage.setItem(ce,p),localStorage.setItem(re,m),p}catch(d){const u=d;return console.error("Failed to fetch Bing daily image:",u),n.value=u.message,"https://picsum.photos/1920/1080"}finally{e.value=!1}}async function a(){try{const{backgroundSettings:d}=s;if(!d){document.body.style.backgroundColor="#f5f5f5",document.body.style.backgroundImage="none";return}const{type:u,color:m,imageUrl:v,opacity:p=.5}=d;if(document.body.style.backgroundImage="none",document.body.style.backgroundColor="transparent",u==="color"&&m)document.body.style.backgroundColor=m;else if(u==="image"&&v)document.body.style.backgroundImage=`url(${v})`,document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center",document.body.style.backgroundRepeat="no-repeat";else if(u==="bing"){const S=await o();document.body.style.backgroundImage=`url(${S})`,document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center",document.body.style.backgroundRepeat="no-repeat"}const l=document.querySelector(".background-overlay");l&&(l.style.opacity=p.toString())}catch(d){console.error("Failed to apply background:",d)}}return{isLoading:e,error:n,getBingDailyImage:o,applyBackground:a}}class Le{constructor(){Q(this,"plugins",new Map);Q(this,"pluginStates",new Map);Q(this,"STORAGE_KEY","pistaink_plugins");this.loadPluginStates()}loadPluginStates(){try{const e=localStorage.getItem(this.STORAGE_KEY);e&&JSON.parse(e).forEach(o=>{this.pluginStates.set(o.id,o)})}catch(e){console.error("加载插件状态失败:",e)}}savePluginStates(){try{const e=Array.from(this.pluginStates.values());localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error("保存插件状态失败:",e)}}registerPlugin(e){if(this.plugins.has(e.id)){console.warn(`插件ID ${e.id} 已存在，无法重复注册`);return}this.plugins.set(e.id,e),this.pluginStates.has(e.id)||(this.pluginStates.set(e.id,{id:e.id,enabled:!0,order:this.pluginStates.size}),this.savePluginStates())}installPlugins(e){for(const n of this.plugins.values()){const o=this.pluginStates.get(n.id);o!=null&&o.enabled&&n.install&&n.install(e)}}enablePlugin(e){const n=this.pluginStates.get(e);if(n){n.enabled=!0,this.savePluginStates();const o=this.plugins.get(e);o!=null&&o.onActivate&&o.onActivate()}}disablePlugin(e){const n=this.pluginStates.get(e);if(n){n.enabled=!1,this.savePluginStates();const o=this.plugins.get(e);o!=null&&o.onDeactivate&&o.onDeactivate()}}getAllPlugins(){return Array.from(this.plugins.values())}getEnabledPlugins(){return this.getAllPlugins().filter(e=>{const n=this.pluginStates.get(e.id);return n&&n.enabled}).sort((e,n)=>{const o=this.pluginStates.get(e.id),a=this.pluginStates.get(n.id);return((o==null?void 0:o.order)||0)-((a==null?void 0:a.order)||0)})}getPluginState(e){return this.pluginStates.get(e)}updatePluginOrder(e,n){const o=this.pluginStates.get(e);o&&(o.order=n,this.savePluginStates())}}const U=new Le,Me={class:"header"},Pe={class:"header-container"},Ne={class:"header-plugins"},Te={class:"header-actions"},Ae={class:"language-selector"},Be={id:"languageDropdown",class:"language-dropdown-menu",style:{display:"none"}},ze=["onClick"],Oe={key:0},Ue={key:1},Re={key:2},qe=z({__name:"Header",setup(s){const e=R(),n=X(),o=e.t,a=M(()=>e.currentLanguage),d=M(()=>e.availableLanguages),u=M(()=>n.themeMode),m=E(!1);function v(g){g.stopPropagation(),g.preventDefault();const f=document.getElementById("languageDropdown");f&&(f.style.display==="block"?f.style.display="none":(f.style.display="block",f.style.visibility="visible",f.style.opacity="1"))}function p(){const g=["light","dark","auto"],$=(g.indexOf(u.value)+1)%g.length;n.setThemeMode(g[$])}function l(g,f){f.stopPropagation(),console.log("切换语言至:",g),e.setLanguage(g);const $=document.getElementById("languageDropdown");$&&($.style.display="none")}function S(){m.value=!0;const g=new CustomEvent("openSettings");window.dispatchEvent(g)}function y(g){const f=document.getElementById("languageDropdown"),$=document.getElementById("languageButton");f&&f.style.display==="block"&&g.target instanceof Node&&!f.contains(g.target)&&!($!=null&&$.contains(g.target))&&(console.log("关闭语言下拉菜单"),f.style.display="none")}return W(()=>{console.log("Header组件已挂载"),document.addEventListener("click",y);const g=document.getElementById("languageDropdown");g&&(g.style.display="none")}),me(()=>{document.removeEventListener("click",y)}),(g,f)=>(w(),x("header",Me,[t("div",Pe,[t("div",Ne,[ye(g.$slots,"plugins",{},void 0,!0)]),t("div",Te,[t("div",Ae,[t("button",{id:"languageButton",onClick:v,class:"language-button"},r(a.value.toUpperCase()),1),t("div",Be,[(w(!0),x(j,null,G(d.value,$=>(w(),x("div",{key:$,onClick:_=>l($,_),class:N(["dropdown-item",{active:$===a.value}])},r($.toUpperCase()),11,ze))),128))])]),t("button",{onClick:p,class:"theme-button"},[u.value==="light"?(w(),x("span",Oe,"🌙")):u.value==="dark"?(w(),x("span",Ue,"☀️")):(w(),x("span",Re,"🔄"))]),t("button",{class:"settings-button",onClick:S}," ⚙️ "+r(c(o)("settings")),1)])])]))}});const O=(s,e)=>{const n=s.__vccOpts||s;for(const[o,a]of e)n[o]=a;return n},je=O(qe,[["__scopeId","data-v-7b010340"]]),Ge={class:"search-box"},Fe={class:"search-container"},Je={class:"engine-selector"},Ve=["src","alt"],He={id:"engineDropdown",style:{display:"none",position:"fixed","z-index":"99999",background:"var(--dropdown-bg)",border:"1px solid var(--border-color)",width:"350px",padding:"12px","border-radius":"8px","box-shadow":"0 2px 8px rgba(0,0,0,0.2)","margin-top":"4px"}},Ye={class:"engine-grid"},Ke=["onClick"],We=["src","alt"],Xe={class:"engine-name"},Qe={class:"add-text"},Ze={class:"search-input-container"},et=["placeholder"],tt={key:0,class:"modal"},nt={class:"modal-content"},ot={class:"modal-header"},at={class:"modal-body"},st={class:"form-group"},lt={for:"engineName"},it={class:"form-group"},ct={for:"engineUrl"},rt={class:"modal-footer"},dt=z({__name:"SearchBox",setup(s){const e=ee(),n=R(),o=n.t,a=M(()=>n.currentLanguage),d=M(()=>e.engines),u=M(()=>e.defaultEngine),m=M(()=>d.value.find(C=>C.id===u.value)||d.value[0]),v=M(()=>m.value?$(m.value):""),p=M(()=>m.value?_(m.value):""),l=E(""),S=E(!1),y=E({name:{[a.value]:""},url:""});function g(C){C.stopPropagation();const I=document.getElementById("engineDropdown"),b=document.getElementById("engineButton");if(I&&b){const D=I.style.display==="block";if(D)I.style.display="none";else{const L=b.getBoundingClientRect();I.style.top=L.bottom+4+"px",I.style.left=L.left+"px",I.style.display="block",console.log("显示下拉菜单，位置:",L.left,L.bottom)}console.log("切换引擎下拉菜单:",D?"隐藏":"显示")}}function f(C,I){I.stopPropagation(),console.log("选择搜索引擎:",C),e.setDefaultEngine(C);const b=document.getElementById("engineDropdown");b&&(b.style.display="none")}function $(C){return C.name[a.value]||Object.values(C.name)[0]||""}function _(C){return C.iconImageData?C.iconImageData:C.iconUrl?C.iconUrl:`https://www.google.com/s2/favicons?domain=${new URL(C.url).hostname}&sz=64`}function i(){if(!l.value.trim()||!m.value)return;const C=m.value.url.replace("{query}",encodeURIComponent(l.value));window.open(C,"_blank")}function k(){S.value=!0;const C=document.getElementById("engineDropdown");C&&(C.style.display="none"),y.value={name:{[a.value]:""},url:""}}function h(){S.value=!1}async function P(){if(!y.value.name[a.value]||!y.value.url){alert("Please fill in all fields");return}const C=fe(y.value.url),I=C.includes("{query}")?C:C+(C.includes("?")?"&q={query}":"?q={query}");try{await e.addEngine({name:y.value.name,url:I}),h()}catch(b){console.error("Failed to add search engine:",b),alert("Failed to add search engine")}}function T(C){const I=document.getElementById("engineDropdown"),b=document.getElementById("engineButton");I&&I.style.display==="block"&&C.target instanceof Node&&!I.contains(C.target)&&!(b!=null&&b.contains(C.target))&&(console.log("关闭搜索引擎下拉菜单"),I.style.display="none")}return W(()=>{console.log("SearchBox组件已挂载"),document.addEventListener("click",T);const C=document.getElementById("engineDropdown");C&&(C.style.display="none")}),me(()=>{document.removeEventListener("click",T)}),(C,I)=>(w(),x("div",Ge,[t("div",Fe,[t("div",Je,[t("button",{id:"engineButton",class:"engine-button",onClick:g},[t("img",{src:p.value,alt:v.value,class:"engine-icon"},null,8,Ve)]),t("div",He,[t("div",Ye,[(w(!0),x(j,null,G(d.value,b=>(w(),x("button",{key:b.id,class:N(["engine-item",{active:b.id===u.value}]),onClick:D=>f(b.id,D),style:{display:"flex","flex-direction":"column","align-items":"center",padding:"8px",color:"var(--text-color)","background-color":"var(--bg-color)"}},[t("img",{src:_(b),alt:$(b),class:"engine-icon"},null,8,We),t("span",Xe,r($(b)),1)],10,Ke))),128)),t("button",{class:"add-engine-button",onClick:k,style:{color:"var(--text-color)","background-color":"var(--bg-color)"}},[I[3]||(I[3]=t("span",{class:"add-icon"},"+",-1)),t("span",Qe,r(c(o)("add_engine")),1)])])])]),t("div",Ze,[F(t("input",{"onUpdate:modelValue":I[0]||(I[0]=b=>l.value=b),placeholder:c(o)("search_placeholder"),class:"search-input",onKeydown:we(i,["enter"])},null,40,et),[[J,l.value]]),t("button",{class:"search-button",onClick:i},r(c(o)("search_button")),1)])]),S.value?(w(),x("div",tt,[t("div",{class:"modal-backdrop",onClick:h}),t("div",nt,[t("div",ot,[t("h3",null,r(c(o)("add_engine")),1),t("button",{class:"close-button",onClick:h},"×")]),t("div",at,[t("div",st,[t("label",lt,r(c(o)("name")),1),F(t("input",{id:"engineName","onUpdate:modelValue":I[1]||(I[1]=b=>y.value.name[a.value]=b)},null,512),[[J,y.value.name[a.value]]])]),t("div",it,[t("label",ct,r(c(o)("url")),1),F(t("input",{id:"engineUrl","onUpdate:modelValue":I[2]||(I[2]=b=>y.value.url=b),placeholder:"https://example.com/search?q={query}"},null,512),[[J,y.value.url]]),t("small",null,r(c(o)("use_{query}_placeholder")),1)])]),t("div",rt,[t("button",{class:"cancel-button",onClick:h},r(c(o)("cancel")),1),t("button",{class:"save-button",onClick:P},r(c(o)("save")),1)])])])):B("",!0)]))}});const ut=O(dt,[["__scopeId","data-v-f5397382"]]),gt={class:"shortcut-grid"},mt={class:"grid-title"},pt={class:"shortcuts-container"},vt=["href"],ft={class:"shortcut-icon"},ht=["src","alt"],_t={class:"shortcut-name"},bt=["onClick"],yt={class:"add-text"},wt={key:0,class:"shortcut-modal"},kt={class:"modal-content"},xt={class:"modal-header"},St={class:"modal-body"},Et={class:"form-group"},$t={for:"shortcutName"},Ct={class:"form-group"},Dt={for:"shortcutUrl"},It={class:"modal-footer"},Lt={class:"action-buttons"},Mt={key:1,class:"confirm-modal"},Pt={class:"modal-content confirm-content"},Nt={class:"confirm-message"},Tt={class:"confirm-actions"},At=z({__name:"ShortcutGrid",setup(s){const e=ee(),n=R(),o=n.t,a=M(()=>n.currentLanguage),d=M(()=>e.shortcuts),u=E(!1),m=E(!1),v=E(!1),p=E({name:{[a.value]:""},url:""});function l(h){return h.name[a.value]||Object.values(h.name)[0]||""}function S(h){return h.iconImageData?h.iconImageData:h.iconUrl?h.iconUrl:`https://www.google.com/s2/favicons?domain=${new URL(h.url).hostname}&sz=64`}function y(){m.value=!1,p.value={name:{[a.value]:""},url:""},u.value=!0}function g(h){m.value=!0,p.value={id:h.id,name:{...h.name},url:h.url},u.value=!0}function f(){u.value=!1}async function $(){try{if(!p.value.name[a.value]||!p.value.url){alert("Please fill in all fields");return}const h=fe(p.value.url);m.value&&p.value.id?await e.updateShortcut(p.value.id,{name:p.value.name,url:h}):await e.addShortcut({name:p.value.name,url:h}),f()}catch(h){console.error("Failed to save shortcut:",h),alert("Failed to save shortcut")}}function _(){v.value=!0}function i(){v.value=!1}async function k(){try{p.value.id&&(await e.deleteShortcut(p.value.id),v.value=!1,f())}catch(h){console.error("Failed to delete shortcut:",h),alert("Failed to delete shortcut")}}return(h,P)=>(w(),x("div",gt,[t("h2",mt,r(c(o)("shortcuts")),1),t("div",pt,[(w(!0),x(j,null,G(d.value,T=>(w(),x("div",{key:T.id,class:"shortcut-item"},[t("a",{href:T.url,target:"_blank",rel:"noopener noreferrer",class:"shortcut-link"},[t("div",ft,[t("img",{src:S(T),alt:l(T)},null,8,ht)]),t("div",_t,r(l(T)),1)],8,vt),t("button",{class:"edit-button",onClick:C=>g(T)},P[2]||(P[2]=[t("span",null,"⋮",-1)]),8,bt)]))),128)),t("div",{class:"shortcut-item add-shortcut",onClick:y},[P[3]||(P[3]=t("div",{class:"add-icon"},"+",-1)),t("div",yt,r(c(o)("add_shortcut")),1)])]),u.value?(w(),x("div",wt,[t("div",{class:"modal-backdrop",onClick:f}),t("div",kt,[t("div",xt,[t("h3",null,r(m.value?c(o)("edit"):c(o)("add_shortcut")),1),t("button",{class:"close-button",onClick:f},"×")]),t("div",St,[t("div",Et,[t("label",$t,r(c(o)("name")),1),F(t("input",{id:"shortcutName","onUpdate:modelValue":P[0]||(P[0]=T=>p.value.name[a.value]=T)},null,512),[[J,p.value.name[a.value]]])]),t("div",Ct,[t("label",Dt,r(c(o)("url")),1),F(t("input",{id:"shortcutUrl","onUpdate:modelValue":P[1]||(P[1]=T=>p.value.url=T),placeholder:"https://example.com"},null,512),[[J,p.value.url]])])]),t("div",It,[m.value?(w(),x("button",{key:0,class:"delete-button",onClick:_},r(c(o)("delete")),1)):B("",!0),t("div",Lt,[t("button",{class:"cancel-button",onClick:f},r(c(o)("cancel")),1),t("button",{class:"save-button",onClick:$},r(c(o)("save")),1)])])])])):B("",!0),v.value?(w(),x("div",Mt,[t("div",{class:"modal-backdrop",onClick:i}),t("div",Pt,[t("div",Nt,r(c(o)("confirm_delete")),1),t("div",Tt,[t("button",{class:"cancel-button",onClick:i},r(c(o)("no")),1),t("button",{class:"delete-confirm-button",onClick:k},r(c(o)("yes")),1)])])])):B("",!0)]))}});const Bt=O(At,[["__scopeId","data-v-18b4e156"]]),zt={class:"plugin-registry",style:{display:"flex","align-items":"center",gap:"8px"}},Ot={key:0,class:"plugin-empty",style:{color:"#666","font-size":"12px"}},Ut=["onClick","title"],Rt={class:"plugin-icon",style:{"font-size":"20px"}},qt=z({__name:"PluginRegistry",setup(s){const e=E([]);W(()=>{console.log("PluginRegistry mounted"),setTimeout(()=>{n(),console.log("Registered plugins:",U.getAllPlugins()),console.log("Enabled plugins:",e.value)},100)});function n(){const a=U.getEnabledPlugins();console.log("Refreshing plugins, found:",a.length),e.value=a}function o(a){console.log("Activating plugin:",a);const d=U.getAllPlugins().find(u=>u.id===a);d&&d.onActivate&&d.onActivate()}return(a,d)=>(w(),x("div",zt,[e.value.length===0?(w(),x("div",Ot," 加载插件中... ")):B("",!0),(w(!0),x(j,null,G(e.value,u=>(w(),x("div",{key:u.id,class:"plugin-item",onClick:m=>o(u.id),title:u.name,style:{display:"flex","align-items":"center","justify-content":"center",width:"36px",height:"36px","border-radius":"50%","background-color":"rgba(255, 255, 255, 0.3)",border:"1px solid rgba(0, 0, 0, 0.1)","backdrop-filter":"blur(4px)",cursor:"pointer",transition:"all 0.2s ease"}},[t("div",Rt,r(u.icon),1)],8,Ut))),128))]))}});const jt=O(qt,[["__scopeId","data-v-ec2cc125"]]),Gt={class:"settings-tab-content"},Ft={class:"form-group"},Jt={class:"theme-options"},Vt=z({__name:"GeneralSettings",setup(s){const e=X(),n=R();return(o,a)=>(w(),x("div",Gt,[t("h3",null,r(c(n).t("general_settings")),1),t("div",Ft,[t("label",null,r(c(n).t("theme")),1),t("div",Jt,[t("button",{onClick:a[0]||(a[0]=d=>c(e).setThemeMode("light")),class:N({active:c(e).themeMode==="light"})},r(c(n).t("light")),3),t("button",{onClick:a[1]||(a[1]=d=>c(e).setThemeMode("dark")),class:N({active:c(e).themeMode==="dark"})},r(c(n).t("dark")),3),t("button",{onClick:a[2]||(a[2]=d=>c(e).setThemeMode("auto")),class:N({active:c(e).themeMode==="auto"})},r(c(n).t("auto")),3)])])]))}});const de=O(Vt,[["__scopeId","data-v-4f2d080a"]]),Ht={class:"settings-tab-content"},Yt={class:"about-info"},Kt=z({__name:"AboutSettings",setup(s){const e=R();return(n,o)=>(w(),x("div",Ht,[t("h3",null,r(c(e).t("about")),1),o[1]||(o[1]=t("p",null,"pistaink.com - v1.0.0",-1)),t("div",Yt,[t("p",null,r(c(e).t("about_description")),1),o[0]||(o[0]=t("div",{class:"links"},[t("a",{href:"https://github.com/your-username/pistaink",target:"_blank",rel:"noopener noreferrer"}," GitHub ")],-1))])]))}});const Wt=O(Kt,[["__scopeId","data-v-bc9a90df"]]),Xt={class:"settings-tab-content"},Qt={class:"engine-list"},Zt={class:"section-header"},en={key:0,class:"empty-state"},tn={key:1,class:"engine-items"},nn={class:"engine-info"},on=["src","alt"],an={class:"engine-details"},sn={class:"engine-name"},ln={class:"engine-url"},cn={class:"engine-actions"},rn=["onClick"],dn=["onClick"],un=["onClick"],gn={key:0,class:"modal"},mn={class:"modal-content"},pn={class:"modal-header"},vn={class:"modal-body"},fn={class:"form-group"},hn={class:"form-group"},_n={class:"modal-footer"},bn={key:1,class:"modal"},yn={class:"modal-content confirm-content"},wn={class:"confirm-message"},kn={class:"confirm-actions"},xn=z({__name:"SearchSettings",setup(s){const e=ee(),n=R(),o=E(!1),a=E(null),d=E(null),u=E({name:{[n.currentLanguage]:""},url:""});function m(i){return i.name[n.currentLanguage]||Object.values(i.name)[0]||""}function v(i){return i.iconImageData?i.iconImageData:i.iconUrl?i.iconUrl:`https://www.google.com/s2/favicons?domain=${new URL(i.url).hostname}&sz=64`}function p(i){return i.length>50?i.substring(0,47)+"...":i}function l(i){e.setDefaultEngine(i)}function S(i){a.value=i,u.value={id:i.id,name:{...i.name},url:i.url}}function y(i){d.value=i}function g(){d.value=null}async function f(){var i;(i=d.value)!=null&&i.id&&(await e.deleteEngine(d.value.id),d.value=null)}async function $(){try{if(!u.value.name[n.currentLanguage]||!u.value.url){alert(n.t("fill_all_fields"));return}let i=u.value.url;i.includes("{query}")||(i+=i.includes("?")?"&q={query}":"?q={query}"),a.value&&u.value.id?await e.updateEngine(u.value.id,{name:u.value.name,url:i}):await e.addEngine({name:u.value.name,url:i}),_()}catch(i){console.error("Failed to save search engine:",i),alert(n.t("save_failed"))}}function _(){o.value=!1,a.value=null,u.value={name:{[n.currentLanguage]:""},url:""}}return(i,k)=>(w(),x("div",Xt,[t("h3",null,r(c(n).t("search_settings")),1),t("div",Qt,[t("div",Zt,[t("h4",null,r(c(n).t("search_engines")),1),t("button",{class:"add-button",onClick:k[0]||(k[0]=h=>o.value=!0)},[k[3]||(k[3]=t("span",null,"+",-1)),ne(" "+r(c(n).t("add_engine")),1)])]),c(e).engines.length===0?(w(),x("div",en,r(c(n).t("no_search_engines")),1)):(w(),x("div",tn,[(w(!0),x(j,null,G(c(e).engines,h=>(w(),x("div",{key:h.id,class:"engine-item"},[t("div",nn,[t("img",{src:v(h),alt:m(h),class:"engine-icon"},null,8,on),t("div",an,[t("div",sn,r(m(h)),1),t("div",ln,r(p(h.url)),1)])]),t("div",cn,[t("button",{class:N(["default-button",{active:c(e).defaultEngine===h.id}]),onClick:P=>l(h.id)},r(c(n).t("default")),11,rn),t("button",{class:"edit-button",onClick:P=>S(h)},r(c(n).t("edit")),9,dn),t("button",{class:"delete-button",onClick:P=>y(h)},r(c(n).t("delete")),9,un)])]))),128))]))]),o.value||a.value?(w(),x("div",gn,[t("div",{class:"modal-backdrop",onClick:_}),t("div",mn,[t("div",pn,[t("h3",null,r(a.value?c(n).t("edit_engine"):c(n).t("add_engine")),1),t("button",{class:"close-button",onClick:_},"×")]),t("div",vn,[t("div",fn,[t("label",null,r(c(n).t("name")),1),F(t("input",{"onUpdate:modelValue":k[1]||(k[1]=h=>u.value.name[c(n).currentLanguage]=h),type:"text"},null,512),[[J,u.value.name[c(n).currentLanguage]]])]),t("div",hn,[t("label",null,r(c(n).t("url")),1),F(t("input",{"onUpdate:modelValue":k[2]||(k[2]=h=>u.value.url=h),type:"text",placeholder:"https://example.com/search?q={query}"},null,512),[[J,u.value.url]]),t("small",null,r(c(n).t("use_{query}_placeholder")),1)])]),t("div",_n,[t("button",{class:"cancel-button",onClick:_},r(c(n).t("cancel")),1),t("button",{class:"save-button",onClick:$},r(c(n).t("save")),1)])])])):B("",!0),d.value?(w(),x("div",bn,[t("div",{class:"modal-backdrop",onClick:g}),t("div",yn,[t("div",wn,r(c(n).t("confirm_delete_engine")),1),t("div",kn,[t("button",{class:"cancel-button",onClick:g},r(c(n).t("no")),1),t("button",{class:"delete-confirm-button",onClick:f},r(c(n).t("yes")),1)])])])):B("",!0)]))}});const Sn=O(xn,[["__scopeId","data-v-d006c94d"]]),En={class:"settings-tab-content"},$n={class:"settings-section"},Cn={class:"action-buttons"},Dn={class:"settings-section"},In={class:"file-upload"},Ln={for:"importFile",class:"file-label"},Mn={key:0,class:"file-name"},Pn={key:0,class:"action-buttons"},Nn={class:"settings-section danger-section"},Tn={class:"action-buttons"},An={key:0,class:"modal"},Bn={class:"modal-content confirm-content"},zn={class:"confirm-message"},On={class:"confirm-actions"},Un=z({__name:"ImportExportSettings",setup(s){const e=R(),n=E(null),o=E(""),a=E(!1);function d(){try{const S=A.exportData(),y=new Blob([S],{type:"application/json"}),g=URL.createObjectURL(y),f=document.createElement("a");f.href=g,f.download=`pistaink_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(f),f.click(),URL.revokeObjectURL(g),document.body.removeChild(f)}catch(S){console.error("Error exporting data:",S),alert(e.t("export_failed"))}}function u(S){const y=S.target;y.files&&y.files.length>0&&(n.value=y.files[0],o.value=y.files[0].name)}function m(){if(!n.value){alert(e.t("select_file_first"));return}const S=new FileReader;S.onload=async y=>{var g;try{if((g=y.target)!=null&&g.result){const f=y.target.result;A.importData(f)?(alert(e.t("import_success")),window.location.reload()):alert(e.t("import_failed"))}}catch(f){console.error("Error importing data:",f),alert(e.t("import_failed"))}},S.readAsText(n.value)}function v(){a.value=!0}function p(){a.value=!1}function l(){try{A.clearAllData(),alert(e.t("reset_success")),window.location.reload()}catch(S){console.error("Error resetting data:",S),alert(e.t("reset_failed"))}a.value=!1}return(S,y)=>(w(),x("div",En,[t("h3",null,r(c(e).t("import_export")),1),t("div",$n,[t("h4",null,r(c(e).t("export_data")),1),t("p",null,r(c(e).t("export_description")),1),t("div",Cn,[t("button",{class:"primary-button",onClick:d},[y[0]||(y[0]=t("span",{class:"icon"},"↓",-1)),ne(" "+r(c(e).t("export")),1)])])]),t("div",Dn,[t("h4",null,r(c(e).t("import_data")),1),t("p",null,r(c(e).t("import_description")),1),t("div",In,[t("label",Ln,[y[1]||(y[1]=t("span",{class:"icon"},"↑",-1)),ne(" "+r(c(e).t("select_file")),1)]),t("input",{type:"file",id:"importFile",accept:".json",onChange:u,class:"file-input"},null,32),o.value?(w(),x("span",Mn,r(o.value),1)):B("",!0)]),o.value?(w(),x("div",Pn,[t("button",{class:"primary-button",onClick:m},r(c(e).t("import")),1)])):B("",!0)]),t("div",Nn,[t("h4",null,r(c(e).t("reset_data")),1),t("p",null,r(c(e).t("reset_description")),1),t("div",Tn,[t("button",{class:"danger-button",onClick:v},r(c(e).t("reset_all_data")),1)])]),a.value?(w(),x("div",An,[t("div",{class:"modal-backdrop",onClick:p}),t("div",Bn,[t("div",zn,r(c(e).t("confirm_reset")),1),t("div",On,[t("button",{class:"cancel-button",onClick:p},r(c(e).t("no")),1),t("button",{class:"delete-confirm-button",onClick:l},r(c(e).t("yes")),1)])])])):B("",!0)]))}});const Rn=O(Un,[["__scopeId","data-v-3dbea325"]]),qn=Z("theme",()=>{const s=ke([]);function e({type:a,message:d,duration:u=3e3}){const m=Date.now().toString();return s.push({id:m,type:a,message:d,duration:u}),setTimeout(()=>{n(m)},u),m}function n(a){const d=s.findIndex(u=>u.id===a);d!==-1&&s.splice(d,1)}function o(){s.splice(0,s.length)}return{notifications:s,showNotification:e,removeNotification:n,clearAllNotifications:o}}),jn={class:"settings-tab-content"},Gn={class:"settings-section"},Fn={class:"language-options"},Jn=["onClick"],Vn={class:"language-flag"},Hn={class:"language-details"},Yn={class:"language-name"},Kn={class:"language-native"},Wn={key:0,class:"language-selected"},Xn={class:"settings-section"},Qn={class:"contributors-list"},Zn={class:"contributor-language"},eo={class:"contributor-names"},to={class:"settings-section"},no=["innerHTML"],oo={class:"action-buttons"},ao={href:"https://github.com/yourusername/pistaink/blob/main/TRANSLATION.md",target:"_blank",class:"primary-button"},so=z({__name:"LanguageSettings",setup(s){const e=R(),n=qn(),o=M(()=>e.currentLanguage),a=[{code:"en",name:"English",nativeName:"English",flag:"🇬🇧"},{code:"zh",name:"Chinese",nativeName:"中文",flag:"🇨🇳"},{code:"es",name:"Spanish",nativeName:"Español",flag:"🇪🇸"},{code:"fr",name:"French",nativeName:"Français",flag:"🇫🇷"},{code:"de",name:"German",nativeName:"Deutsch",flag:"🇩🇪"},{code:"ja",name:"Japanese",nativeName:"日本語",flag:"🇯🇵"},{code:"ko",name:"Korean",nativeName:"한국어",flag:"🇰🇷"},{code:"ru",name:"Russian",nativeName:"Русский",flag:"🇷🇺"}],d={en:["John Doe","Jane Smith"],zh:["Li Wei","Zhang Min"],es:["Carlos Rodriguez","Maria Garcia"],fr:["Jean Dupont","Marie Leclerc"],de:["Hans Müller","Greta Schmidt"],ja:["Tanaka Hiroshi","Suzuki Yuki"],ko:["Kim Min-jun","Park Ji-hye"],ru:["Ivan Petrov","Natasha Ivanova"]};function u(v){e.setLanguage(v),setTimeout(()=>{n.showNotification({type:"success",message:e.t("language_changed"),duration:3e3})},100)}function m(v){const p=a.find(l=>l.code===v);return p?p.name:v}return(v,p)=>(w(),x("div",jn,[t("h3",null,r(c(e).t("language")),1),t("div",Gn,[t("h4",null,r(c(e).t("select_language")),1),t("p",null,r(c(e).t("language_description")),1),t("div",Fn,[(w(),x(j,null,G(a,l=>t("div",{key:l.code,class:N(["language-option",{selected:o.value===l.code}]),onClick:S=>u(l.code)},[t("div",Vn,r(l.flag),1),t("div",Hn,[t("div",Yn,r(l.name),1),t("div",Kn,r(l.nativeName),1)]),o.value===l.code?(w(),x("div",Wn," ✓ ")):B("",!0)],10,Jn)),64))])]),t("div",Xn,[t("h4",null,r(c(e).t("language_contributors")),1),t("p",null,r(c(e).t("language_contributors_description")),1),t("div",Qn,[(w(),x(j,null,G(d,(l,S)=>t("div",{key:S,class:"contributor-group"},[t("div",Zn,r(m(S))+" ("+r(S)+")",1),t("div",eo,r(l.join(", ")),1)])),64))])]),t("div",to,[t("h4",null,r(c(e).t("help_translate")),1),t("p",{innerHTML:c(e).t("translation_help_description")},null,8,no),t("div",oo,[t("a",ao,r(c(e).t("translation_guide")),1)])])]))}});const lo=O(so,[["__scopeId","data-v-84b79ce2"]]),io={key:0,class:"settings-modal",style:{display:"flex"}},co={class:"settings-content"},ro={class:"settings-header"},uo={class:"settings-body"},go={class:"settings-sidebar"},mo={class:"settings-panel"},po=z({__name:"SettingsPanel",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(s,{emit:e}){const n=e;X();const o=R(),a=E("general"),d={general:de,search:Sn,import:Rn,language:lo,about:Wt},u=M(()=>d[a.value]||de);function m(){n("update:modelValue",!1)}return(v,p)=>s.modelValue?(w(),x("div",io,[t("div",{class:"modal-backdrop",onClick:m}),t("div",co,[t("div",ro,[t("h2",null,r(c(o).t("settings")),1),t("button",{class:"close-button",onClick:m},"×")]),t("div",uo,[t("div",go,[t("div",{class:N(["sidebar-item",{active:a.value==="general"}]),onClick:p[0]||(p[0]=l=>a.value="general")},r(c(o).t("general")),3),t("div",{class:N(["sidebar-item",{active:a.value==="search"}]),onClick:p[1]||(p[1]=l=>a.value="search")},r(c(o).t("search")),3),t("div",{class:N(["sidebar-item",{active:a.value==="import"}]),onClick:p[2]||(p[2]=l=>a.value="import")},r(c(o).t("import_export")),3),t("div",{class:N(["sidebar-item",{active:a.value==="language"}]),onClick:p[3]||(p[3]=l=>a.value="language")},r(c(o).t("language")),3),t("div",{class:N(["sidebar-item",{active:a.value==="about"}]),onClick:p[4]||(p[4]=l=>a.value="about")},r(c(o).t("about")),3)]),t("div",mo,[(w(),se(Se,null,[(w(),se(xe(u.value)))],1024))])])])])):B("",!0)}});const vo=O(po,[["__scopeId","data-v-69ed5b20"]]),fo={class:"drawing-container"},ho={class:"drawing-tools"},_o={class:"tool-group"},bo={class:"color-picker"},yo=["onClick"],wo={class:"size-selector"},ko={class:"size-value"},xo={class:"background-selector"},So=["onClick"],Eo={class:"canvas-wrapper"},$o=z({__name:"DrawingCanvas",setup(s){const e=E(null);let n=null,o=!1,a=0,d=0;const u=E("brush"),m=E("#000000"),v=E(5),p=["#000000","#ffffff","#ff0000","#ff9900","#ffff00","#00ff00","#0099ff","#6633ff"],l=E("#ffffff"),S=["#ffffff","#f0f0f0","#f5f5dc","#e0f7fa","#f9fbe7","#fff3e0","#fbe9e7","#f3e5f5"];pe(l,()=>{g()});function y(b){l.value=b}function g(){if(!n||!e.value)return;const b=n.getImageData(0,0,e.value.width,e.value.height);n.fillStyle=l.value,n.fillRect(0,0,e.value.width,e.value.height),n.putImageData(b,0,0)}W(()=>{e.value&&(f(),n=e.value.getContext("2d"),n&&(n.lineCap="round",n.lineJoin="round",n.strokeStyle=m.value,n.lineWidth=v.value,n.fillStyle=l.value,n.fillRect(0,0,e.value.width,e.value.height)),window.addEventListener("resize",f))});function f(){if(!e.value)return;const b=e.value.parentElement;b&&(e.value.width=b.clientWidth,e.value.height=300,n&&(n.fillStyle=l.value,n.fillRect(0,0,e.value.width,e.value.height)))}function $(b){u.value=b}function _(b){m.value=b,n&&(n.strokeStyle=b)}function i(b){o=!0;const D=e.value.getBoundingClientRect();a=b.clientX-D.left,d=b.clientY-D.top}function k(b){if(!o||!n||!e.value)return;const D=e.value.getBoundingClientRect(),L=b.clientX-D.left,V=b.clientY-D.top;n.strokeStyle=u.value==="eraser"?l.value:m.value,n.lineWidth=v.value,n.beginPath(),n.moveTo(a,d),n.lineTo(L,V),n.stroke(),a=L,d=V}function h(){o=!1}function P(b){if(!e.value)return;b.preventDefault();const D=b.touches[0],L=e.value.getBoundingClientRect();a=D.clientX-L.left,d=D.clientY-L.top,o=!0}function T(b){if(!o||!n||!e.value)return;b.preventDefault();const D=b.touches[0],L=e.value.getBoundingClientRect(),V=D.clientX-L.left,ae=D.clientY-L.top;n.strokeStyle=u.value==="eraser"?l.value:m.value,n.lineWidth=v.value,n.beginPath(),n.moveTo(a,d),n.lineTo(V,ae),n.stroke(),a=V,d=ae}function C(){!n||!e.value||(n.fillStyle=l.value,n.fillRect(0,0,e.value.width,e.value.height))}function I(){if(!e.value)return;const b=e.value.toDataURL("image/png"),D=document.createElement("a");D.download=`pistaink-drawing-${new Date().getTime()}.png`,D.href=b,D.click()}return(b,D)=>(w(),x("div",fo,[t("div",ho,[t("div",_o,[t("button",{class:N(["tool-btn",{active:u.value==="brush"}]),onClick:D[0]||(D[0]=L=>$("brush")),title:"画笔"}," 🖌️ ",2),t("button",{class:N(["tool-btn",{active:u.value==="eraser"}]),onClick:D[1]||(D[1]=L=>$("eraser")),title:"橡皮擦"}," 🧽 ",2)]),t("div",bo,[(w(),x(j,null,G(p,L=>t("div",{key:L,class:N(["color-option",{active:m.value===L}]),style:le({background:L}),onClick:V=>_(L)},null,14,yo)),64))]),t("div",wo,[F(t("input",{type:"range",min:"1",max:"50","onUpdate:modelValue":D[2]||(D[2]=L=>v.value=L),class:"size-slider"},null,512),[[J,v.value,void 0,{number:!0}]]),t("span",ko,r(v.value)+"px",1)]),t("div",xo,[D[3]||(D[3]=t("span",null,"背景:",-1)),(w(),x(j,null,G(S,L=>t("div",{key:L,class:N(["bg-color-option",{active:l.value===L}]),style:le({background:L}),onClick:V=>y(L)},null,14,So)),64))])]),t("div",Eo,[t("canvas",{ref_key:"canvas",ref:e,class:"drawing-canvas",onMousedown:i,onMousemove:k,onMouseup:h,onMouseleave:h,onTouchstart:P,onTouchmove:T,onTouchend:h},null,544)]),t("div",{class:"canvas-actions"},[t("button",{class:"action-btn",onClick:C},"清除"),t("button",{class:"action-btn",onClick:I},"保存")])]))}});const ue=O($o,[["__scopeId","data-v-e90b735f"]]),te=E(!1),Co={id:"drawing",name:"绘画板",description:"简易绘画工具，支持多种画笔和颜色",icon:"✏️",version:"1.0.0",component:ue,install(s){console.log("绘画插件已安装")},onActivate(){te.value=!0;const s=document.createElement("div");s.classList.add("drawing-modal"),s.innerHTML=`
		<div class="drawing-modal-backdrop"></div>
		<div class="drawing-modal-content">
			<div class="drawing-modal-header">
				<h3>绘画板</h3>
				<button class="drawing-modal-close">×</button>
			</div>
			<div id="drawing-container"></div>
		</div>
		`,document.body.appendChild(s);const e=document.getElementById("drawing-container");e&&ve(ue).mount(e);const n=s.querySelector(".drawing-modal-close");n&&n.addEventListener("click",()=>{document.body.removeChild(s),te.value=!1});const o=s.querySelector(".drawing-modal-backdrop");o&&o.addEventListener("click",()=>{document.body.removeChild(s),te.value=!1});const a=document.createElement("style");a.textContent=`
		.drawing-modal {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: 1000;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		
		.drawing-modal-backdrop {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5);
		}
		
		.drawing-modal-content {
			position: relative;
			width: 80%;
			max-width: 800px;
			background-color: white;
			border-radius: 8px;
			box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
			z-index: 1001;
			overflow: hidden;
		}
		
		.drawing-modal-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 10px 16px;
			border-bottom: 1px solid #eee;
		}
		
		.drawing-modal-header h3 {
			margin: 0;
		}
		
		.drawing-modal-close {
			background: none;
			border: none;
			font-size: 24px;
			cursor: pointer;
			color: #666;
		}
		
		@media (max-width: 768px) {
			.drawing-modal-content {
				width: 95%;
			}
		}
		`,document.head.appendChild(a)},onDeactivate(){console.log("绘画插件已禁用")}};E(!1);const Do={id:"screenshot",name:"网页截图",description:"截取当前网页并保存",icon:"📷",version:"1.0.0",install(s){console.log("截图插件已安装")},onActivate(){const s=document.createElement("div");s.textContent="正在截取屏幕...",s.style.cssText=`
			position: fixed;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			background-color: rgba(0, 0, 0, 0.7);
			color: white;
			padding: 8px 16px;
			border-radius: 4px;
			z-index: 10000;
		`,document.body.appendChild(s),setTimeout(()=>{setTimeout(()=>{document.body.removeChild(s);const e=document.createElement("canvas"),n=e.getContext("2d");if(e.width=window.innerWidth,e.height=window.innerHeight,n){n.fillStyle="white",n.fillRect(0,0,e.width,e.height),n.font="24px Arial",n.fillStyle="black",n.textAlign="center",n.fillText("屏幕截图功能示例",e.width/2,e.height/2),n.font="16px Arial",n.fillText(`时间: ${new Date().toLocaleString()}`,e.width/2,e.height/2+40);const o=e.toDataURL("image/png"),a=document.createElement("a");a.download=`screenshot-${new Date().getTime()}.png`,a.href=o,a.click()}},500)},100)},onDeactivate(){console.log("截图插件已禁用")}},Io=["#ff5252","#ff4081","#e040fb","#7c4dff","#536dfe","#448aff","#40c4ff","#18ffff","#64ffda","#69f0ae","#b2ff59","#eeff41","#ffff00","#ffd740","#ffab40","#ff6e40"],Lo={id:"color-picker",name:"颜色提取器",description:"从网页中提取主要颜色",icon:"🎨",version:"1.0.0",install(s){console.log("颜色提取器插件已安装")},onActivate(){const s=document.createElement("div");s.className="color-picker-panel";const e=document.createElement("div");e.className="color-picker-header",e.innerHTML=`
			<h3>颜色提取器</h3>
			<button class="color-picker-close">×</button>
		`,s.appendChild(e);const n=document.createElement("div");n.className="color-grid",Io.forEach(u=>{const m=document.createElement("div");m.className="color-item",m.style.backgroundColor=u,m.setAttribute("data-color",u),m.addEventListener("click",()=>{navigator.clipboard.writeText(u).then(()=>{m.setAttribute("data-copied","true"),m.innerText="已复制",setTimeout(()=>{m.innerText="",m.removeAttribute("data-copied")},1e3)})}),n.appendChild(m)}),s.appendChild(n);const o=document.createElement("p");o.className="color-picker-hint",o.textContent="点击颜色块复制色值",s.appendChild(o),document.body.appendChild(s);const a=s.querySelector(".color-picker-close");a&&a.addEventListener("click",()=>{document.body.removeChild(s)});const d=document.createElement("style");d.textContent=`
		.color-picker-panel {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 320px;
			background-color: white;
			border-radius: 8px;
			box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			overflow: hidden;
		}
		
		.color-picker-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 10px 16px;
			border-bottom: 1px solid #eee;
		}
		
		.color-picker-header h3 {
			margin: 0;
			font-size: 16px;
		}
		
		.color-picker-close {
			background: none;
			border: none;
			font-size: 24px;
			cursor: pointer;
			color: #666;
		}
		
		.color-grid {
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			gap: 8px;
			padding: 16px;
		}
		
		.color-item {
			position: relative;
			width: 100%;
			height: 60px;
			border-radius: 4px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-size: 12px;
			font-weight: bold;
			text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
			transition: transform 0.2s;
		}
		
		.color-item:hover {
			transform: scale(1.05);
		}
		
		.color-item[data-copied="true"] {
			outline: 2px solid #333;
		}
		
		.color-picker-hint {
			text-align: center;
			color: #666;
			padding: 0 16px 16px;
			margin: 0;
			font-size: 12px;
		}
		`,document.head.appendChild(d)},onDeactivate(){console.log("颜色提取器插件已禁用")}},he="pistaink_memos";function Mo(){try{const s=localStorage.getItem(he);return s?JSON.parse(s):[]}catch(s){return console.error("加载便签失败:",s),[]}}function ge(s){localStorage.setItem(he,JSON.stringify(s))}function Po(){const s=["#ffcdd2","#f8bbd0","#e1bee7","#d1c4e9","#c5cae9","#bbdefb","#b3e5fc","#b2ebf2","#b2dfdb","#c8e6c9","#dcedc8","#f0f4c3","#fff9c4","#ffecb3","#ffe0b2","#ffccbc"];return s[Math.floor(Math.random()*s.length)]}const No={id:"memo",name:"便签",description:"创建和管理便签",icon:"📝",version:"1.0.0",install(s){console.log("便签插件已安装")},onActivate(){const s=Mo(),e=document.createElement("div");e.className="memo-panel";const n=document.createElement("div");n.className="memo-header",n.innerHTML=`
			<h3>我的便签</h3>
			<button class="memo-close">×</button>
		`,e.appendChild(n);const o=document.createElement("div");o.className="memo-list";function a(){if(o.innerHTML="",s.length===0){const v=document.createElement("p");v.className="memo-empty",v.textContent="没有便签，点击下方按钮添加",o.appendChild(v)}else s.forEach((v,p)=>{const l=document.createElement("div");l.className="memo-item",l.style.backgroundColor=v.color;const S=document.createElement("div");S.className="memo-content",S.textContent=v.content,l.appendChild(S);const y=document.createElement("div");y.className="memo-date",y.textContent=new Date(v.createdAt).toLocaleString(),l.appendChild(y);const g=document.createElement("button");g.className="memo-delete",g.textContent="删除",g.addEventListener("click",f=>{f.stopPropagation(),s.splice(p,1),ge(s),a()}),l.appendChild(g),o.appendChild(l)})}a(),e.appendChild(o);const d=document.createElement("button");d.className="memo-add-btn",d.textContent="添加便签",d.addEventListener("click",()=>{const v=prompt("请输入便签内容:");if(v&&v.trim()){const p={id:Date.now().toString(),content:v.trim(),color:Po(),createdAt:Date.now()};s.unshift(p),ge(s),a()}}),e.appendChild(d),document.body.appendChild(e);const u=e.querySelector(".memo-close");u&&u.addEventListener("click",()=>{document.body.removeChild(e)});const m=document.createElement("style");m.textContent=`
		.memo-panel {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 320px;
			max-height: 80vh;
			background-color: white;
			border-radius: 8px;
			box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		}
		
		.memo-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 10px 16px;
			border-bottom: 1px solid #eee;
			background-color: #f5f5f5;
		}
		
		.memo-header h3 {
			margin: 0;
			font-size: 16px;
		}
		
		.memo-close {
			background: none;
			border: none;
			font-size: 24px;
			cursor: pointer;
			color: #666;
		}
		
		.memo-list {
			flex: 1;
			overflow-y: auto;
			padding: 8px;
			max-height: 400px;
		}
		
		.memo-empty {
			text-align: center;
			color: #999;
			padding: 20px;
		}
		
		.memo-item {
			position: relative;
			padding: 12px;
			margin-bottom: 8px;
			border-radius: 4px;
			box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
		}
		
		.memo-content {
			margin-bottom: 8px;
			white-space: pre-wrap;
			word-break: break-word;
		}
		
		.memo-date {
			font-size: 12px;
			color: rgba(0, 0, 0, 0.6);
		}
		
		.memo-delete {
			position: absolute;
			top: 8px;
			right: 8px;
			background: rgba(255, 255, 255, 0.5);
			border: none;
			border-radius: 4px;
			padding: 2px 6px;
			font-size: 12px;
			cursor: pointer;
			opacity: 0;
			transition: opacity 0.2s;
		}
		
		.memo-item:hover .memo-delete {
			opacity: 1;
		}
		
		.memo-add-btn {
			margin: 8px;
			padding: 8px;
			background-color: #2196f3;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			font-weight: bold;
			transition: background-color 0.2s;
		}
		
		.memo-add-btn:hover {
			background-color: #1976d2;
		}
		`,document.head.appendChild(m)},onDeactivate(){console.log("便签插件已禁用")}},To={class:"app-container"},Ao={class:"main-content"},Bo=z({__name:"App",setup(s){const e=ee(),n=X(),o=R(),a=Ie(),d=E(!1);function u(){d.value=!0}W(async()=>{if(console.log("App component mounted"),console.log("清除本地存储..."),localStorage.removeItem("pistaink_app_data"),console.log("本地存储已清除"),console.log("正在加载应用数据..."),await e.loadData(),console.log("应用数据加载完成"),console.log("Registering plugins..."),U.registerPlugin(Co),U.registerPlugin(Do),U.registerPlugin(Lo),U.registerPlugin(No),console.log("Plugins registered:",U.getAllPlugins().length),await o.initI18n(),await n.loadSettings(),a.applyBackground(),e.engines.length===0||e.shortcuts.length===0){if(console.log("搜索引擎或快捷方式为空，尝试重新加载数据..."),await e.loadData(),e.engines.length===0){console.log("仍然无法加载搜索引擎，使用硬编码数据");const p=[{id:"google",name:{zh:"谷歌",en:"Google"},url:"https://www.google.com/search?q="},{id:"bing",name:{zh:"必应",en:"Microsoft Bing"},url:"https://www.bing.com/search?q="}];for(const l of p)await e.addEngine(l);await e.setDefaultEngine("bing")}if(e.shortcuts.length===0){console.log("仍然无法加载快捷方式，使用硬编码数据");const p=[{name:{zh:"GitHub",en:"GitHub"},url:"https://github.com"},{name:{zh:"YouTube",en:"YouTube"},url:"https://youtube.com"}];for(const l of p)await e.addShortcut(l)}}const v=window.matchMedia("(prefers-color-scheme: dark)");m(v),v.addEventListener("change",m),window.addEventListener("openSettings",u),pe(()=>n.themeMode,p=>{document.documentElement.setAttribute("data-theme",p),p==="auto"&&m(window.matchMedia("(prefers-color-scheme: dark)"))},{immediate:!0})}),Ee(()=>{window.matchMedia("(prefers-color-scheme: dark)").removeEventListener("change",m),window.removeEventListener("openSettings",u)});function m(v){const p=v.matches;n.themeMode==="auto"&&document.documentElement.setAttribute("data-theme",p?"dark":"light")}return(v,p)=>(w(),x("div",To,[H(je,null,{plugins:$e(()=>[H(jt)]),_:1}),t("main",Ao,[H(ut),H(Bt)]),H(vo,{modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=l=>d.value=l)},null,8,["modelValue"])]))}});document.documentElement.style.setProperty("--primary-color","#3498db");document.documentElement.style.setProperty("--border-color","#e0e0e0");document.documentElement.style.setProperty("--card-bg","#ffffff");document.documentElement.style.setProperty("--dropdown-bg","#ffffff");document.documentElement.style.setProperty("--text-color","#333333");document.documentElement.style.setProperty("--shadow-color","rgba(0, 0, 0, 0.1)");console.log("应用初始化开始");const oe=ve(Bo);oe.use(Ce());console.log("插件管理器初始化");U.installPlugins(oe);oe.mount("#app");window.addEventListener("load",()=>{console.log("Window loaded, plugins available:",U.getAllPlugins().length)});console.log("应用初始化完成");
